define(["jquery","core/str","core/log","core/config"],function(a,b,c,d){"use strict";function e(){a.ajax({url:d.wwwroot+"/local/maintenance_livecheck/ajax.php",dataType:"json",type:"POST",data:{time:a.now()},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(a){null===a.timeleftinsec?(g(),j=null,clearInterval(k)):null!==a.timeleftinsec&&a.timeleftinsec>0?(f(),j=a.timeleftinsec,clearInterval(k),k=setInterval(i,1e3)):null!==a.timeleftinsec&&0==a.timeleftinsec&&(f(),j=0,clearInterval(k),i())},error:function(a){503==a.status&&"Moodle under maintenance"==a.statusText?(f(),j=0,clearInterval(k),i()):a.status>=300&&a.status<=399&&(c.debug("moodle-local_maintenance_livecheck-livecheck: A cached copy of the live check answer was returned so it's reliablity cannot be guaranteed. Hiding the maintenance announcement box now."),g(),j=null,clearInterval(k))}})}function f(){null===l&&(a("#maintenance_announcement").append('<div class="box moodle-has-zindex maintenancewarning m-a-1 alert">'),l=a(".box.maintenancewarning"))}function g(){null!==l&&(a("#maintenance_announcement").empty(),l=null)}function h(){b.get_strings([{key:"sitemaintenance",component:"admin"},{key:"maintenancemodeisscheduled",component:"admin"},{key:"maintenancemodeisscheduledlong",component:"admin"}])}function i(){if(j-=1,j<=0)b.get_string("sitemaintenance","admin").done(function(a){l.html(a)});else{var a={};a.sec=Math.floor(j%60),a.min=Math.floor(j/60)%60,a.hour=Math.floor(j/3600),a.hour>0?b.get_string("maintenancemodeisscheduledlong","admin",a).done(function(a){l.html(a)}):b.get_string("maintenancemodeisscheduled","admin",a).done(function(a){l.html(a)})}j<30?l.addClass("alert-error").addClass("alert-danger").removeClass("alert-warning"):l.addClass("alert-warning").removeClass("alert-error").removeClass("alert-error")}var j=null,k=null,l=null;return{init:function(b){null!==b.checkinterval&&b.checkinterval>0&&(a("body").append('<div id="maintenance_announcement">'),null!==b.backoff&&b.backoff>0?setTimeout(function(){setInterval(e,1e3*b.checkinterval)},1e3*b.backoff):setInterval(e,1e3*b.checkinterval),h())}}});