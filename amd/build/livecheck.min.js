define ("local_maintenance_livecheck/livecheck",["jquery","core/str","core/log","core/config"],function(a,b,c,d){"use strict";var j=null,k=null,l=null;function e(){if(null===l){a("#maintenance_announcement").append("<div class=\"box moodle-has-zindex maintenancewarning m-a-1 alert\">");l=a(".box.maintenancewarning")}}function f(){if(null!==l){a("#maintenance_announcement").empty();l=null}}function g(){b.get_strings([{key:"sitemaintenance",component:"admin"},{key:"maintenancemodeisscheduled",component:"admin"},{key:"maintenancemodeisscheduledlong",component:"admin"}])}function h(){j-=1;if(0>=j){b.get_string("sitemaintenance","admin").done(function(a){l.html(a)})}else{var c={sec:Math.floor(j%60),min:Math.floor(j/60)%60,hour:Math.floor(j/3600)};if(0<c.hour){b.get_string("maintenancemodeisscheduledlong","admin",c).done(function(a){l.html(a)})}else{b.get_string("maintenancemodeisscheduled","admin",c).done(function(a){l.html(a)})}}if(30>j){l.addClass("alert-error").addClass("alert-danger").removeClass("alert-warning")}else{l.addClass("alert-warning").removeClass("alert-error").removeClass("alert-error")}}function i(){a.ajax({url:d.wwwroot+"/local/maintenance_livecheck/ajax.php",dataType:"json",type:"POST",data:{time:a.now()},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function success(a){if(null===a.timeleftinsec){f();j=null;clearInterval(k)}else if(null!==a.timeleftinsec&&0<a.timeleftinsec){e();j=a.timeleftinsec;clearInterval(k);k=setInterval(h,1e3)}else if(null!==a.timeleftinsec&&0===a.timeleftinsec){e();j=0;clearInterval(k);h()}},error:function error(a){if(503==a.status&&"Moodle under maintenance"==a.statusText){e();j=0;clearInterval(k);h()}else if(300<=a.status&&399>=a.status){c.debug("moodle-local_maintenance_livecheck-livecheck: A cached copy of the live check answer was returned so it's reliablity cannot be guaranteed. Hiding the maintenance announcement box now.");f();j=null;clearInterval(k)}}})}return{init:function init(b){if(null!==b.checkinterval&&0<b.checkinterval){a("body").append("<div id=\"maintenance_announcement\">");if(null!==b.backoff&&0<b.backoff){setTimeout(function(){setInterval(i,1e3*b.checkinterval)},1e3*b.backoff)}else{setInterval(i,1e3*b.checkinterval)}g()}}}});
//# sourceMappingURL=livecheck.min.js.map
