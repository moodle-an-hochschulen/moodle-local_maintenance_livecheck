define(["jquery","core/str"],function(a,b){"use strict";function c(){a.ajax({url:"/local/maintenance_livecheck/ajax.php",dataType:"json",success:function(a){null===a.timeleftinsec?(e(),h=null,clearInterval(i)):null!==a.timeleftinsec&&a.timeleftinsec>0?(d(),h=a.timeleftinsec,clearInterval(i),i=setInterval(g,1e3)):null!==a.timeleftinsec&&0==a.timeleftinsec&&(d(),h=0,clearInterval(i),g())},error:function(a){503==a.status&&"Moodle under maintenance"==a.statusText&&(d(),h=0,clearInterval(i),g())}})}function d(){null===j&&(a("#maintenance_announcement").append('<div class="box moodle-has-zindex maintenancewarning m-a-1 alert">'),j=a(".box.maintenancewarning"))}function e(){null!==j&&(a("#maintenance_announcement").empty(),j=null)}function f(){b.get_strings([{key:"sitemaintenance",component:"admin"},{key:"maintenancemodeisscheduled",component:"admin"},{key:"maintenancemodeisscheduledlong",component:"admin"}])}function g(){if(h-=1,h<=0)b.get_string("sitemaintenance","admin").done(function(a){j.html(a)});else{var a={};a.sec=Math.floor(h%60),a.min=Math.floor(h/60)%60,a.hour=Math.floor(h/3600),a.hour>0?b.get_string("maintenancemodeisscheduledlong","admin",a).done(function(a){j.html(a)}):b.get_string("maintenancemodeisscheduled","admin",a).done(function(a){j.html(a)})}h<30?j.addClass("alert-error").addClass("alert-danger").removeClass("alert-warning"):j.addClass("alert-warning").removeClass("alert-error").removeClass("alert-error")}var h=null,i=null,j=null;return{init:function(b){a("body").append('<div id="maintenance_announcement">'),null!==b.checkinterval&&b.checkinterval>0&&(null!==b.backoff&&b.backoff>0?setTimeout(function(){setInterval(c,1e3*b.checkinterval)},1e3*b.backoff):setInterval(c,1e3*b.checkinterval)),f()}}});