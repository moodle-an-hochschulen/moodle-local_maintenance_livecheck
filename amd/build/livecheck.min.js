define(["jquery","core/str","core/log"],function(a,b,c){"use strict";function d(){a.ajax({url:"/local/maintenance_livecheck/ajax.php",dataType:"json",success:function(a){null===a.timeleftinsec?(f(),i=null,clearInterval(j)):null!==a.timeleftinsec&&a.timeleftinsec>0?(e(),i=a.timeleftinsec,clearInterval(j),j=setInterval(h,1e3)):null!==a.timeleftinsec&&0==a.timeleftinsec&&(e(),i=0,clearInterval(j),h())},error:function(a){503==a.status&&"Moodle under maintenance"==a.statusText?(e(),i=0,clearInterval(j),h()):a.status>=300&&a.status<=399&&(c.debug("moodle-local_maintenance_livecheck-livecheck: A cached copy of the live check answer was returned so it's reliablity cannot be guaranteed. Hiding the maintenance announcement box now."),f(),i=null,clearInterval(j))}})}function e(){null===k&&(a("#maintenance_announcement").append('<div class="box moodle-has-zindex maintenancewarning m-a-1 alert">'),k=a(".box.maintenancewarning"))}function f(){null!==k&&(a("#maintenance_announcement").empty(),k=null)}function g(){b.get_strings([{key:"sitemaintenance",component:"admin"},{key:"maintenancemodeisscheduled",component:"admin"},{key:"maintenancemodeisscheduledlong",component:"admin"}])}function h(){if(i-=1,i<=0)b.get_string("sitemaintenance","admin").done(function(a){k.html(a)});else{var a={};a.sec=Math.floor(i%60),a.min=Math.floor(i/60)%60,a.hour=Math.floor(i/3600),a.hour>0?b.get_string("maintenancemodeisscheduledlong","admin",a).done(function(a){k.html(a)}):b.get_string("maintenancemodeisscheduled","admin",a).done(function(a){k.html(a)})}i<30?k.addClass("alert-error").addClass("alert-danger").removeClass("alert-warning"):k.addClass("alert-warning").removeClass("alert-error").removeClass("alert-error")}var i=null,j=null,k=null;return{init:function(b){null!==b.checkinterval&&b.checkinterval>0&&(a("body").append('<div id="maintenance_announcement">'),null!==b.backoff&&b.backoff>0?setTimeout(function(){setInterval(d,1e3*b.checkinterval)},1e3*b.backoff):setInterval(d,1e3*b.checkinterval),g())}}});